#
# For a description of the syntax of this configuration file,
# see Documentation/kbuild/kconfig-language.txt.
#

config 64BIT
	def_bool y

config GENERIC_CALIBRATE_DELAY
	def_bool y

config FIX_EARLYCON_MEM
	def_bool y

config MMU
	def_bool y

config KALLSYMS_BASE_RELATIVE
        def_bool n

config GENERIC_CSUM
	def_bool y

config RWSEM_GENERIC_SPINLOCK
	def_bool y

config GENERIC_HWEIGHT
	def_bool y

config HAVE_COPY_THREAD_TLS
	def_bool y

config K1C
	def_bool y
	select OF
	select OF_EARLY_FLATTREE
	select OF_RESERVED_MEM
	select GENERIC_IRQ_CHIP
	select GENERIC_IRQ_PROBE
	select GENERIC_IRQ_SHOW
	select GENERIC_IOMAP
	select GENERIC_CPU_DEVICES
	select GENERIC_CLOCKEVENTS
	select GENERIC_STRNLEN_USER
	select GENERIC_STRNCPY_FROM_USER
	select THREAD_INFO_IN_TASK
	select COMMON_CLK
	select CLKSRC_OF
	select GENERIC_CLOCKEVENTS
	select TIMER_OF
	select K1C_CORE_INTC
	select K1C_APIC_GIC
	select K1C_APIC_MAILBOX
	select K1C_ITGEN
	select SPARSE_IRQ
	select ARCH_WANT_FRAME_POINTERS
	select ARCH_CLOCKSOURCE_DATA
	select HAVE_GENERIC_DMA_COHERENT
	select HAVE_PCI
	select HAVE_ARCH_JUMP_LABEL

config PGTABLE_LEVELS
	int
	default 2 if K1C_64K_PAGES
	default 3

config HAVE_KPROBES
	def_bool n

menu "System setup"

config PANIC_SYSCALL
	bool "Emit a magic syscall in panic"
	default y
	help
	  In order to validate the step where the kernel goes, we need
	  to emit an exit signal if the panic match the expected one.
	  Enabling this option add a panic notifier.

config PANIC_SYSCALL_EXPECTED
        string "Expected panic string"
        depends on PANIC_SYSCALL
        default ""
        help
          Expected string by syscall panic notifier. If panic string
          matches the expected, exit with 0, else exit with 1.

config POISON_INITMEM
	bool "Enable to poison freed initmem"
	default y
        help
          In order to debug initmem, using poison allows to verify if
	  some data/code is stille using them. Enable this for debug
	  purposes

config K1C_PHYS_OFFSET
	hex "RAM address of memory base"
	default 0x100000000

config K1C_PAGE_OFFSET
	hex "kernel virtual address of memory base"
	default 0xFFFFFF8000000000

config STACK_MAX_DEPTH_TO_PRINT
	int "Maximum depth of stack to print"
	range 1 128
	default "24"

config DEBUG_EXCEPTION_STACK
	bool "Enable exception stack debugging"
	default n
	help
	  Enable stack check debugging when entering/exiting
	  exception handlers.
	  This can be particularly helpful after modifying stack
	  handling to see if stack when exiting is the same as the one
	  when entering exception handler.

config SECURE_DAME_HANDLING
	bool "Secure DAME handling"
	default y
	help
	  In order to securely handle Data Asynchronous Memory Errors, we need
	  to do a barrier upon kernel entry when coming from userspace. This
	  barrier guarantee us that any pending DAME will be serviced right
	  away. We also need to do a barrier when returning from kernel to user.
	  This way, if the kernel or the user triggered a DAME, it will be
	  serviced by knowing we are coming from kernel or user and avoid
	  pulling the wrong lever (panic for kernel or sigfault for user).
	  This can be costly but ensure that user cannot interfere with kernel.
	  /!\ Do not disable unless you want to open a giant breach between
	  user and kernel /!\

config NR_CPUS
	int "Maximum number of CPUs"
	range 2 16
	depends on SMP
	help
	  Kalray support can handle a maximum of 16 CPUs.

choice
	prompt "Page size"
	default K1C_4K_PAGES
	help
	  Page size (translation granule) configuration.

config K1C_4K_PAGES
	bool "4KB"
	help
	  This feature
	  enables 4KB
	  pages
	  support.

config K1C_64K_PAGES
	bool "64KB"
	help
	  This feature
	  enables 64KB
	  pages support
	  (4KB by default).

endchoice

config K1C_PAGE_SHIFT
	int
	default 16 if K1C_64K_PAGES
	default 12

config CMDLINE
        string "Default kernel command string"
        default ""
        help
          On some architectures there is currently no way for the boot loader
          to pass arguments to the kernel. For these architectures, you should
          supply some command-line options at build time by entering them
          here.

endmenu

menuconfig K1C_DEBUG
	bool "K1C debugging"
	default y
if K1C_DEBUG
config K1C_DEBUG_ASN
	bool "Check ASN before writing TLB entry"
	default y
	help
	  This option allows to check if the ASN of the current
	  process is matching the ASN found in MMC. If it is not the
	  case an error will be print.

config K1C_DEBUG_TLB_ACCESS_BITS
	int "Number of bits used as index of entries in logged table"
	default 12
	help
	  Set the number of bits used as index of entries that will be logged
	  in a ring buffer called k1c_tlb_access. One entry in the table
	  contains registers TEL, TEH and MMC. It also logs the type of the
	  operations (0:read, 1:write, 2:probe). Buffer is per CPU. For one
	  entry 24 bytes are used. So by default it uses 96Ko of memory per
	  CPU to store 2^12 (4096) entries.
endif

menu "Kernel Features"
source "kernel/Kconfig.hz"
endmenu
